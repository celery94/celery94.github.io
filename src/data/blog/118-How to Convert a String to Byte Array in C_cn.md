---
pubDatetime: 2024-04-24
tags: [".NET", "C#"]
source: https://www.devleader.ca/2024/04/21/how-to-convert-a-string-to-byte-array-in-c-encoding-and-decoding-simplified/
author: Nick Cosentino
title: 如何在C#中将字符串转换为字节数组
description: 学习如何在C#中有效地将字符串转换为字节数组！虽然这在表面上看起来很简单，但我们需要考虑编码！
---

> ## 摘要
>
> 学习如何在C#中有效地将字符串转换为字节数组！虽然这在表面上看起来很简单，但我们需要考虑编码！
>
> 原文 [How to Convert a String to Byte Array in C# – Encoding and Decoding Simplified](https://www.devleader.ca/2024/04/21/how-to-convert-a-string-to-byte-array-in-c-encoding-and-decoding-simplified/)

---

在编程中，我们经常需要在字符串和字节之间转换。人类阅读字符串。计算机读取字节。因此，对我们.net开发者来说，理解如何在C#中将字符串转换为字节数组非常重要。我们通过一个称为编码和解码的过程，在两者之间来回转换。

在这篇文章中，我将提供代码示例，以便你能够在C#中将字符串转换为字节数组 —— 并再次转换回来！你还将了解一些需要注意的字符编码的细微差别！

---

如果我们想将一个字符串转换成一个字节数组——或反过来——我们需要理解编码和解码的概念。在软件工程中，编码指的是将一个字符串转换成一个字节序列的过程，而解码涉及到将字节反向转换回字符串的过程。听起来很简单，对吧？

记住字符串是字符的序列，字符的概念对我们读者来说非常有意义，但计算机理解字节。字符本身可以在计算机中用数字表示，所以当我们想在较低的级别上处理字符串时，比如在网络上传输数据或将其存储在文件中时，我们需要将字符串转换成字节数组。

在将字符串转换为字节数组时，编码起到了作用。它决定了字符串中的字符如何被表示为字节。[编码方案定义了字符与它们字节表示之间的映射](https://www.devleader.ca/2023/09/19/ascii-vs-utf8-how-to-navigate-character-encoding/)。[常见的编码方案包括UTF-8、UTF-16、ASCII和Unicode](https://www.devleader.ca/2023/09/19/ascii-vs-utf8-how-to-navigate-character-encoding/ "ASCII vs UTF8 – 如何导航字符编码")。

选择正确的编码很重要，因为不同的编码方案支持不同的字符集。例如，ASCII仅支持基本英文字母（外加一些其他字符），而UTF-8和UTF-16能够表示多种语言和脚本的字符。不过，稍后再详细介绍这一点，因为我知道你迫切想要看到一些代码！

---

## 选择编码以将字符串转换为字节数组

在C#中将字符串转换为字节数组时，考虑字符编码是最重要的事情之一。字符编码决定了字符和字节值之间的映射，如果你正考虑以某种方式转换数据，那么你可能会想要考虑如何反向转换！

这是什么意思呢？嗯，如果我们使用一个数据转换——比方说，用ASCII编码将一个字符串转换成字节——如果某个特定字符没有映射到一个字节表示，我们就会在结果中丢失那个数据。现在，如果你想反过来，将你的字节数组转换回字符串会怎样呢？

数据丢失了！

在C#中，有多种编码可用，包括ASCII、UTF-8和UTF-16，每种都有其特定的特点和使用场景。让我们探索这些编码，并看看它们如何用于字符串到字节数组的转换。

### ASCII编码

ASCII编码使用7位表示字符，允许总共有128个不同的字符。它主要适用于处理基本英文[字符，与其他编码相比更节省空间](https://www.devleader.ca/2023/09/19/ascii-vs-utf8-how-to-navigate-character-encoding/)。这里有一个使用ASCII编码将字符串转换为字节数组的示例：

```csharp
string text = "Hello, World!";
byte[] asciiBytes = Encoding.ASCII.GetBytes(text);
```

在许多现代应用程序中，ASCII可能不是你所追求的。特别是如果你的用户遍布全球，且所在地区不是英语区域。这并不是说，ASCII\*不能\*使用，但你需要小心选择你将要ASCII编码的数据，以避免在编码转换过程中丢失信息。

因此，请记住， ASCII [字符集使用7位编码](https://www.devleader.ca/2023/09/19/ascii-vs-utf8-how-to-navigate-character-encoding/)方案来表示字符，允许总共有128个唯一的字符。然而，随着国际化和多语言支持的需求不断增长，仅使用ASCII就不足以有效表示所有字符了。

好在我们有一些其他的选择即将介绍！

### UTF-8编码

UTF-8编码是一个可变长度编码方案，能够表示任何Unicode字符。它被广泛用于编码各种语言的文本，并且与ASCII兼容。它对表示ASCII字符使用较少的字节，但对非ASCII字符可能需要更多字节。这里有一个使用UTF-8编码将字符串转换为字节数组的示例：

```csharp
string text = "Привет, мир!";
byte[] utf8Bytes = Encoding.UTF8.GetBytes(text);
```

### UTF-16编码

UTF-16编码使用2或4个字节来表示字符，使其能够表示任何Unicode字符。它通常被需要处理多语言文本的应用程序使用，或当与其他系统的互操作性要求时使用。编码可以是小端或大端，前者更为普遍。这里有一个使用UTF-16编码将字符串转换为字节数组的示例：

```csharp
string text = "こんにちは、世界！";
byte[] utf16Bytes = Encoding.Unicode.GetBytes(text);
```

---

## UTF-8编码与UTF-16编码的区别是什么？

这些编码都是可变宽度的，它们的大小在考虑不同字母表时赋予它们不同的特点。

从UTF-8开始，它是可变宽度的并与ASCII向后兼容。在这种编码中：

- ASCII字符，范围在U+0000到U+007F之间，仅需要1个字节。
- 在下一个区间，代码点U+0080到U+07FF每个占用两倍的空间，即2个字节。
- 代码点U+0800到U+FFFF采用更多的字节，即3个字节
- 最后，代码点U+10000到U+10FFFF需要4个字节。

对于英文文本来说，这可以非常有效，因为这些字符将占用最小的空间。然而，当涉及到亚洲文本时，它并不理想，原因恰恰相反。

因为UTF-16从代码点U+0000到U+FFFF占用2个字节，代码点U+10000到U+10FFFF的占用量是前者的两倍，即4个字节，对于英文来说并不那么好。但它\*确实\*更适合亚洲字符。

甚至还有UTF-32编码！这是一种固定宽度编码，其中所有代码点都占用四字节——与我提到的其他编码不同，后者的大小是动态的。这可能比其他编码使用更多的存储空间，但由于其简单性，操作速度可能会快得多。

请考虑你主要需要支持的字母表！

---

## 字符串到字节数组转换的最佳实践

在C#中将字符串转换为字节数组时，遵循最佳实践以确保效率和可靠性至关重要。在这一节中，我将讨论在执行字符串到字节数组转换时，你应该记住的一些关键最佳实践。

### 错误处理和验证

在处理编码时，处理潜在的错误并验证你的数据非常重要，以防止你的代码中出现意外行为。理想情况下，你应该构建你的应用程序的流程，以便你知道你正在处理什么类型的数据。如果你能编写代码来避免错误，这是首选的方式！

我们不想依赖于此，但有时这是我们无法控制的——处理错误的一种方法是使用try-catch块。通过在try块中封装转换代码，你可以捕获转换过程中可能发生的任何异常，并优雅地处理它们。如果你无法控制输入数据的来源，为了安全，这是你可能需要做的事情之一。

###

编码选择

C#为将字符串转换为字节数组提供了几种编码选项，如UTF-8、UTF-16、ASCII等。根据应用程序的具体要求选择适当的编码非常重要。在选择编码时，考虑字符集、与其他系统的兼容性以及性能影响等因素。

```csharp
// 编码选择示例
string inputString = "Hello, World!";
byte[] encodedBytes = Encoding.UTF8.GetBytes(inputString);
```

正如我们在之前的示例中看到的，我们选择编码类后，可以选择静态属性来持有编码实例。如果我们需要选择一个作为变量和参数传递的编码，你绝对可以在一个专用的编码引用中存储它：

```csharp
Encoding selectedEncoding = Encoding.UTF8;
SomeMethod("Hello World!", selectedEncoding);
```

错误选择编码可能会对你的应用程序产生重大后果！特别是如果你以一种将丢失数据分辨率且无法逆转的编码保存数据……所以要小心翼翼！

---

## 常见问题解答：如何在C#中将字符串转换为字节数组

### 为什么在字符串到字节数组转换中，编码和解码很重要？

编码和解码在字符串到字节数组转换中很重要，因为它确保字符在字节数组中得到正确的表示，并且可以在以后准确地转换回原始字符串。

### 在C#中可以使用哪种方法将字符串转换为字节数组？

在C#中，可以使用`Encoding.GetBytes`方法将字符串转换为字节数组。例如，`Encoding.ASCII.GetBytes`使用ASCII编码将字符串转换为字节数组。可以选择其他编码。

### 使用`Encoding.ASCII.GetBytes`将字符串转换为字节数组有什么限制？

使用`Encoding.ASCII.GetBytes`的一个限制是它仅支持ASCII字符，无法正确处理非ASCII字符或多字节字符。要处理非ASCII字符，需要使用例如UTF-8或UTF-16这样的其他编码。

### 在选择字符串到字节数组转换的编码时，应该考虑哪些因素？

在选择字符串到字节数组转换的编码时，考虑字符串中使用的特定字符集很重要。不同的[编码处理不同的字符](https://www.devleader.ca/2023/09/19/ascii-vs-utf8-how-to-navigate-character-encoding/)集，选择错误的编码可能导致转换不正确。

### 如何在字符串到字节数组转换中处理非ASCII字符？

要在字符串到字节数组转换中处理非ASCII字符，需要选择适当的编码，例如UTF-8或UTF-16。这些[编码可以处理广泛的字符](https://www.devleader.ca/2023/09/19/ascii-vs-utf8-how-to-navigate-character-encoding/)，并提供准确的转换。
