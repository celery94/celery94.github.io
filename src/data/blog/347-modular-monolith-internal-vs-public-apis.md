---
pubDatetime: 2025-05-31
tags: [.NET, æ¶æ„è®¾è®¡, æ¨¡å—åŒ–å•ä½“, å¾®æœåŠ¡, åç«¯å¼€å‘]
slug: modular-monolith-internal-vs-public-apis
source: https://www.milanjovanovic.tech/blog/internal-vs-public-apis-in-modular-monoliths
title: æ¨¡å—åŒ–å•ä½“æ¶æ„ä¸­çš„å†…éƒ¨ä¸å…¬å…± APIï¼šæ§åˆ¶æ··ä¹±ï¼Œæˆå°±é«˜è´¨é‡ç³»ç»Ÿ
description: æ·±å…¥æ¢è®¨.NETæ¨¡å—åŒ–å•ä½“æ¶æ„ä¸­ï¼Œæ¨¡å—é—´é€šä¿¡ä¸ºä½•è¦é‡‡ç”¨å…¬å…±APIã€å¦‚ä½•è®¾è®¡å¥‘çº¦ï¼Œä»¥åŠå®ç°é«˜å†…èšã€ä½è€¦åˆçš„å®è·µç­–ç•¥ã€‚é€‚åˆæ¶æ„å¸ˆä¸ä¸­é«˜çº§å¼€å‘è€…ç²¾è¿›ç³»ç»Ÿè®¾è®¡èƒ½åŠ›ã€‚
---

# æ¨¡å—åŒ–å•ä½“æ¶æ„ä¸­çš„å†…éƒ¨ä¸å…¬å…± APIï¼šæ§åˆ¶æ··ä¹±ï¼Œæˆå°±é«˜è´¨é‡ç³»ç»Ÿ

åœ¨è®¾è®¡å¤§å‹åç«¯ç³»ç»Ÿæ—¶ï¼Œæ¨¡å—åŒ–å•ä½“æ¶æ„ï¼ˆModular Monolithï¼‰æ­£æˆä¸ºè¶Šæ¥è¶Šå¤š.NETæŠ€æœ¯å›¢é˜Ÿçš„é¦–é€‰æ–¹æ¡ˆã€‚å®ƒæ—¢èƒ½äº«å—å•ä½“åº”ç”¨çš„ç®€æ´éƒ¨ç½²ï¼Œåˆèƒ½é€šè¿‡æ˜ç¡®çš„æ¨¡å—è¾¹ç•Œæå‡å¯ç»´æŠ¤æ€§ã€‚ä½†å…³äºæ¨¡å—ä¹‹é—´çš„é€šä¿¡ï¼Œä½ çœŸçš„åšå¯¹äº†å—ï¼Ÿæœ¬æ–‡å°†ç»“åˆå®æˆ˜ç»éªŒï¼Œæ·±å…¥å‰–æå†…éƒ¨ API ä¸å…¬å…± API çš„åŒºåˆ«ã€è®¾è®¡åŸåˆ™åŠè½åœ°ç»†èŠ‚ï¼ŒåŠ©ä½ æ‰“é€ çœŸæ­£é«˜è´¨é‡çš„ä¼ä¸šçº§ç³»ç»Ÿã€‚

---

![æ¨¡å—é€šä¿¡é€‰é¡¹ï¼šç›´æ¥æ•°æ®åº“è®¿é—®ã€è°ƒç”¨å†…éƒ¨æœåŠ¡ã€è°ƒç”¨å…¬å…±API](https://www.milanjovanovic.tech/blogs/mnw_120/module_communication_options.png?imwidth=3840)

_å›¾1ï¼šæ¨¡å—é—´çš„ä¸‰ç§å¸¸è§é€šä¿¡æ–¹å¼_

## å¼•è¨€ï¼šä¸ºä»€ä¹ˆâ€œå…¬å…± APIâ€è¿™ä¹ˆé‡è¦ï¼Ÿ

æ— æ•°å…³äºæ¨¡å—åŒ–å•ä½“çš„æ–‡ç« éƒ½åœ¨åå¤å¼ºè°ƒï¼šâ€œæ¨¡å—ä¹‹é—´è¦ç”¨å…¬å…± API é€šä¿¡â€ï¼Œä½†å¾ˆå°‘æœ‰äººè®²æ¸…æ¥šâ€”â€”

- ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥è®¿é—®å…¶ä»–æ¨¡å—çš„æ•°æ®æˆ–æœåŠ¡ï¼Ÿ
- å…¬å…± API åˆ°åº•è§£å†³äº†ä»€ä¹ˆç—›ç‚¹ï¼Ÿ
- å…·ä½“åº”è¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ

éšç€æˆ‘ä»¬ç³»ç»Ÿè§„æ¨¡æ‰©å¤§ï¼Œå¦‚æœæ²¡æœ‰åˆç†çš„è¾¹ç•Œå’Œå¥‘çº¦ï¼Œæ¨¡å—é—´è‡ªç”±è€¦åˆã€æ•°æ®åº“ç›´è¿ï¼Œæœ€ç»ˆå°†ç³»ç»Ÿæ‹–å…¥ä¸å¯ç»´æŠ¤çš„â€œæ³¥æ½­â€ã€‚å…¬å…± APIï¼Œå°±æ˜¯æˆ‘ä»¬æ§åˆ¶è¿™ç§æ··ä¹±ã€è®©ä¾èµ–æ˜¾æ€§åŒ–çš„å…³é”®å·¥å…·ã€‚

---

## 1ï¸âƒ£ æ¨¡å—é—´é€šä¿¡çš„ç°å®ï¼šè€¦åˆæ— å¤„ä¸åœ¨ï¼Œå…³é”®åœ¨äºâ€œå¯æ§â€

é¦–å…ˆè¦æ‰“ç ´ä¸€ä¸ªè¯¯åŒºï¼šå…¬å…± API å¹¶ä¸æ˜¯ä¸ºäº†æ¶ˆé™¤è€¦åˆï¼Œè€Œæ˜¯è®©è€¦åˆ**å¯æ§**ã€‚æ¨¡å— A éœ€è¦ç”¨åˆ°æ¨¡å— B çš„èƒ½åŠ›æ—¶ï¼Œæœ‰ä¸‰ç§å¸¸è§åšæ³•ï¼š

1. **ç›´æ¥è®¿é—®å¯¹æ–¹æ•°æ®åº“**ï¼ˆâŒææ˜“å¤±æ§ï¼‰
2. **ç›´æ¥è°ƒç”¨å¯¹æ–¹å†…éƒ¨æœåŠ¡**ï¼ˆâŒéšå¼è€¦åˆï¼‰
3. **é€šè¿‡å…¬å…± API æ˜ç¡®å¥‘çº¦é€šä¿¡**ï¼ˆâœ…æ¨èåšæ³•ï¼‰

ç›´æ¥æ•°æ®åº“è®¿é—®å’Œè°ƒç”¨å†…éƒ¨æœåŠ¡ï¼Œçœ‹ä¼¼æ–¹ä¾¿ï¼Œå´ä¼šå¯¼è‡´ï¼š

- è·¨æ¨¡å—éšæ„è¯»å–ã€ä¿®æ”¹æ•°æ®ï¼Œè¾¹ç•Œå½¢åŒè™šè®¾
- ä»»æ„å˜æ›´æ•°æ®ç»“æ„ï¼Œå½±å“å…¨å±€ï¼Œç»´æŠ¤éš¾åº¦æ¿€å¢

é‡‡ç”¨å…¬å…± APIï¼Œåˆ™å¯ä»¥ï¼š

- æ˜¾æ€§å£°æ˜ä¾èµ–å…³ç³»
- é¿å…â€œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«â€çš„è¿é”ååº”
- æ”¯æŒåç»­å†…éƒ¨é‡æ„è€Œä¸å½±å“å…¶ä»–æ¨¡å—

> ğŸ“ **è¡¥å……ï¼šå³ä½¿é‡‡ç”¨å¼‚æ­¥æ¶ˆæ¯é€šä¿¡ï¼Œæ¶ˆæ¯å¥‘çº¦æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§â€œå…¬å…± APIâ€ã€‚**  
> [è¿›ä¸€æ­¥é˜…è¯»ï¼šå¼‚æ­¥æ¨¡å—é€šä¿¡æ¨¡å¼](https://www.milanjovanovic.tech/blog/modular-monolith-communication-patterns)

---

## 2ï¸âƒ£ ä¸ºä»€ä¹ˆéœ€è¦å…¬å…± APIï¼Ÿä¸‰å¤§æ ¸å¿ƒä½œç”¨

### â‘  å¥‘çº¦å®šä¹‰ï¼ˆContract Definitionï¼‰

å…¬å…± API æ˜ç¡®å£°æ˜äº†â€œåˆ«äººå¯ä»¥å¯¹æˆ‘åšä»€ä¹ˆã€ä¸èƒ½åšä»€ä¹ˆâ€ï¼Œæ˜¯è¾¹ç•Œçš„ä½“ç°ã€‚

### â‘¡ ä¾èµ–ç®¡ç†ï¼ˆDependency Controlï¼‰

åªæœ‰é€šè¿‡å…¬å…± APIï¼Œä¾èµ–æ‰æ˜¯é€æ˜ã€å¯è¿½è¸ªçš„ï¼Œå¦åˆ™ç³»ç»Ÿå¤æ‚åº¦éš¾ä»¥æŠŠæ§ã€‚

### â‘¢ å˜æ›´å¯æ§ï¼ˆChange Managementï¼‰

åªè¦ä¿è¯å…¬å…± API ä¸å˜ï¼Œå†…éƒ¨å¯ä»¥éšæ„é‡æ„ï¼Œå¤§å¤§é™ä½äº†ç»´æŠ¤æˆæœ¬ã€‚

#### ä»£ç ç¤ºä¾‹ï¼šæ­£ç¡® vs. é”™è¯¯çš„æ¨¡å—ä¾èµ–

```csharp
// é”™è¯¯æ–¹å¼ï¼šShipping ç›´æ¥è®¿é—® Orders çš„æ•°æ®åº“
public class ShippingService
{
    private readonly OrdersDbContext _ordersDb; // âŒ å¼ºè€¦åˆ

    public async Task ShipOrder(string orderId)
    {
        var order = await _ordersDb.Orders
            .Include(o => o.Lines)
            .FirstOrDefaultAsync(o => o.Id == orderId);
    }
}
```

```csharp
// æ¨èæ–¹å¼ï¼šé€šè¿‡ IOrdersModule å…¬å…± API è·å–è®¢å•ä¿¡æ¯
public class ShippingService
{
    private readonly IOrdersModule _orders;

    public async Task ShipOrder(string orderId)
    {
        var order = await _orders.GetOrderForShippingAsync(orderId);
    }
}
```

---

## 3ï¸âƒ£ å¦‚ä½•è®¾è®¡é«˜è´¨é‡çš„å…¬å…± APIï¼Ÿ

### ğŸ“Œ æš´éœ²â€œç”¨ä¾‹â€ï¼Œè€Œéâ€œæ•°æ®è¡¨â€

- **ä¸è¦**ç›´æ¥æš´éœ² CRUD æ¥å£
- **è¦**æ ¹æ®å…¶ä»–æ¨¡å—çœŸå®ä¸šåŠ¡éœ€æ±‚ï¼Œå®šåˆ¶ä¸“ç”¨æ¥å£

```csharp
public interface IOrdersModule
{
    // âŒ é€šç”¨CRUDï¼ˆæ˜“æ»¥ç”¨ï¼‰
    // Task<Order> GetOrderAsync(string orderId);

    // âœ… åŸºäºç”¨ä¾‹çš„æ¥å£
    Task<OrderShippingInfo> GetOrderForShippingAsync(string orderId);
    Task<OrderPaymentInfo> GetOrderForPaymentAsync(string orderId);
    Task<OrderSummary> GetOrderForCustomerAsync(string orderId);
}
```

### ğŸ“Œ é»˜è®¤ä¸å¯¹å¤–å¼€æ”¾ï¼ŒæŒ‰éœ€ç²¾ç»†æš´éœ²

- æœ€å¼€å§‹ä¿æŒæ‰€æœ‰å†…å®¹ç§æœ‰ï¼Œé€æ­¥æŒ‰éœ€å¼€æ”¾
- æ¯æ¬¡å¼€æ”¾éƒ½éœ€è¯„ä¼°å…¶å¿…è¦æ€§å’Œæœªæ¥ç»´æŠ¤æˆæœ¬

---

## 4ï¸âƒ£ æ•°æ®ä¿æŠ¤ä¸è¾¹ç•Œéš”ç¦»çš„ä¸‰æ¿æ–§

å³ä½¿æœ‰äº†å…¬å…± APIï¼Œä¹Ÿä¸èƒ½æ‰ä»¥è½»å¿ƒã€‚æ•°æ®å±‚é¢çš„éš”ç¦»åŒæ ·é‡è¦ï¼š

#### ä¸€ã€**ç‹¬ç«‹æ•°æ®åº“ Schema**

ä¸ºæ¯ä¸ªæ¨¡å—åˆ†é…ç‹¬ç«‹çš„æ•°æ®åº“ Schemaï¼Œç”¨æƒé™éš”ç¦»ä¿è¯åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®ã€‚

```sql
CREATE SCHEMA Orders;
CREATE SCHEMA Shipping;

CREATE USER OrdersUser WITH DEFAULT_SCHEMA = Orders;
GRANT SELECT, INSERT, UPDATE, DELETE ON SCHEMA::Orders TO OrdersUser;
```

#### äºŒã€**ç‹¬ç«‹è¿æ¥å­—ç¬¦ä¸²å’Œ DbContext**

ä¸ºæ¯ä¸ªæ¨¡å—é…ç½®ç‹¬ç«‹çš„æ•°æ®åº“è¿æ¥å’Œ DbContextã€‚

```csharp
builder.Services.AddDbContext<OrdersDbContext>(options =>
    options.UseSqlServer(builder.Configuration.GetConnectionString("OrdersConnection")));
builder.Services.AddDbContext<ShippingDbContext>(options =>
    options.UseSqlServer(builder.Configuration.GetConnectionString("ShippingConnection")));
```

> ğŸ” å»¶ä¼¸é˜…è¯»ï¼š[å•åº”ç”¨ä¸­å¦‚ä½•ä½¿ç”¨å¤šä¸ª EF Core DbContext](https://www.milanjovanovic.tech/blog/using-multiple-ef-core-dbcontext-in-single-application)

#### ä¸‰ã€**ä¸“ç”¨è¯»æ¨¡å‹ DTO**

å¯¹å¤–åªæš´éœ²ç²¾ç®€çš„åªè¯»æ¨¡å‹ï¼ˆDTOï¼‰ï¼Œç»ä¸æš´éœ²å®Œæ•´é¢†åŸŸå¯¹è±¡ã€‚

```csharp
internal class Order { /* å†…éƒ¨å®Œæ•´æ¨¡å‹ */ }

public class OrderShippingInfo // å¯¹å¤–åªæš´éœ²å¿…è¦ä¿¡æ¯
{
    public string OrderId { get; init; }
    public Address ShippingAddress { get; init; }
    public List<ShippingItem> Items { get; init; }
}
```

---

## 5ï¸âƒ£ è·¨æ¨¡å—æŸ¥è¯¢æ€ä¹ˆåŠï¼Ÿæ¨èäº‹ä»¶é©±åŠ¨è¯»æ¨¡å‹

æœ‰äº›æŸ¥è¯¢éœ€æ±‚å¤©ç„¶è·¨è¶Šå¤šä¸ªæ¨¡å—ï¼ˆå¦‚â€œç”¨æˆ·è®¢å•å†å²â€ï¼‰ï¼Œå¼ºè¡Œé€šè¿‡æ¨¡å— API æ‹¼å‡‘å¹¶ä¸å¯å–ã€‚æ›´ä¼˜æ–¹æ¡ˆï¼š

1. æ–°å»ºä¸“é—¨çš„æŸ¥è¯¢æ¨¡å‹ï¼ˆå¦‚ OrderHistoryModuleï¼‰
2. ç”¨é¢†åŸŸäº‹ä»¶é©±åŠ¨åŒæ­¥å„æ¨¡å—å˜åŒ–
3. æŸ¥è¯¢æ—¶åªè¯»èšåˆå¥½çš„æ•°æ®

```csharp
public class OrderHistoryModule
{
    public async Task<CustomerOrderHistory> GetOrderHistoryAsync(string customerId)
    {
        return await _orderHistoryRepository.GetCustomerHistoryAsync(customerId);
    }
}
```

---

## ç»“è®ºï¼šè®©ä¾èµ–æ˜¾æ€§åŒ–ï¼Œæ‹¥æŠ±å¯ç»´æŠ¤çš„æœªæ¥

å…¬å…± API å¹¶éä¸‡èƒ½é’¥åŒ™ï¼Œä¹Ÿä¸æ˜¯ä¸ºäº†æœç»ä¸€åˆ‡ä¾èµ–ã€‚å®ƒçš„çœŸæ­£ä»·å€¼ï¼Œåœ¨äºï¼š

- è®©ä¾èµ–é€æ˜ã€å¯è¿½è¸ªã€å¯ç»´æŠ¤ ğŸ§©
- é™ä½å˜æ›´é£é™©ï¼Œæå‡å›¢é˜Ÿåä½œæ•ˆç‡ ğŸ”’
- ä¸ºç³»ç»Ÿæ¼”è¿›é¢„ç•™ç©ºé—´ï¼Œå‡å°‘â€œæŠ€æœ¯å€ºåŠ¡â€ ğŸ—ï¸

åªæœ‰æŠŠæ§å¥½è¿™äº›ç»†èŠ‚ï¼Œä½ çš„.NETæ¨¡å—åŒ–å•ä½“æ‰èƒ½çœŸæ­£é«˜å†…èšã€ä½è€¦åˆï¼Œç»å¾—ä½å¤§è§„æ¨¡ä¸šåŠ¡å¢é•¿ä¸æŠ€æœ¯è¿­ä»£çš„è€ƒéªŒã€‚

---

### ğŸ’¬ äº’åŠ¨æ—¶é—´

ä½ åœ¨å®è·µæ¨¡å—åŒ–å•ä½“æ¶æ„æ—¶é‡åˆ°è¿‡å“ªäº›â€œæ··ä¹±â€çš„åœºæ™¯ï¼Ÿä½ çš„å›¢é˜Ÿåˆæ˜¯å¦‚ä½•å¤„ç†æ¨¡å—é—´é€šä¿¡å’Œä¾èµ–ç®¡ç†çš„ï¼Ÿ  
æ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºï¼Œä¹Ÿå¯ä»¥åˆ†äº«æœ¬æ–‡åˆ°ä½ çš„æŠ€æœ¯ç¾¤ç»„ï¼Œä¸€èµ·æå‡æ¶æ„åŠŸåŠ›ï¼
