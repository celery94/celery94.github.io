---
pubDatetime: 2025-10-08
title: 开发者与 AI 代码审查：如何有效审查 AI 生成的 .NET 代码
description: 深入探讨如何成为一名优秀的 AI 代码审查者，掌握审查 AI 生成代码的关键技能和最佳实践，确保代码质量、可靠性与可维护性，提升团队整体生产力。
tags: [".NET", "AI", "Architecture", "DevOps"]
slug: reviewing-ai-generated-code-in-dotnet
source: https://devblogs.microsoft.com/dotnet/developer-and-ai-code-reviewer-reviewing-ai-generated-code-in-dotnet
---

随着 GitHub Copilot 等 AI 工具在软件开发中的广泛应用，开发者的角色正在经历一场变革。我们不再仅仅是代码的编写者，更成为 AI 生成代码的把关者。这种转变为团队带来了新的挑战和机遇：虽然代码审查的工作量可能增加，但我们也获得了提升代码质量的全新契机。

本文将深入探讨如何成为一名高效的 AI 代码审查者，帮助你在保持开发效率的同时，确保 AI 生成代码的质量、可靠性和可维护性。

## AI 代码生成如何提升生产力

近期的开发团队数据显示，集成 AI 代码生成工具可以将功能交付速度提升 20% 至 40%。然而，这种生产力的提升并非无条件的，它完全依赖于代码审查者是否能确保生成的代码符合最高标准。

通过采用一致的审查实践，开发团队可以在后期节省大量的调试和重构时间，即使增加了审查工作，整体上仍能实现净生产力提升。更重要的是，许多审查者反馈他们在审查过程中对代码库和技术有了更深入的理解，因为他们经常能接触到 AI 提供的新模式和解决方案。

## AI 代码审查的六大核心关注点

审查 AI 生成的代码时，我们需要特别关注以下几个关键领域：

### 1. API 设计与接口架构

AI 在设计 API 时往往会引入一些不必要的复杂性，审查者需要保持警惕：

**接口抽象层次**：AI 经常会创建不必要的抽象层。例如，当 `TokenCredential` 本身已经是抽象类时，我们不需要再为它创建接口。在审查时，应该质疑每一层抽象的必要性，确保接口设计简洁直接。

**命名一致性**：AI 生成的方法命名可能不一致，比如同时出现 `WithHostPort` 和 `WithBrowserPort` 这样的命名风格。审查者需要确保所有命名遵循项目既定的命名规范，保持整个代码库的一致性。

**API 可见性控制**：AI 倾向于将方法设置为 `public`，即使它们可能只需要 `internal` 访问级别。过度暴露的 API 会增加维护负担并可能导致误用。审查时要仔细评估每个成员的访问级别，尽可能缩小 API 表面。

**扩展方法模式**：当 AI 生成 Builder 模式的扩展方法时，要验证它们是否遵循团队已建立的约定，包括命名风格、参数顺序和返回类型等。

### 2. 测试与可测试性

测试覆盖是代码质量的基石，但 AI 在这方面经常存在不足：

**单元测试完整性**：AI 生成的新公共方法可能缺乏相应的单元测试。例如，当添加 `GetOrCreateResourceAsync` 方法时，应立即要求 AI 补充完整的单元测试，包括正常流程、异常情况和边界条件。

**测试组织方式**：AI 生成的测试往往使用通用的断言方式（如简单的 `Assert.True`），而不是更精确的快照测试。推荐使用 Verify 等快照测试库来确保测试更加健壮和可维护。

**具体的断言**：审查测试时要确保断言验证具体的值和行为，而不仅仅是笼统的结果。例如，不要只检查结果不为空，而应验证返回的具体数据内容。

**保护现有测试**：在集成新代码时，AI 可能会无意中修改现有的测试。审查者需要警惕这类变更，确保现有测试的意图和覆盖范围不会被削弱。

### 3. 文件组织与架构

良好的代码组织是可维护性的前提，AI 在这方面可能缺乏整体视角：

**自动生成文件的保护**：AI 可能会无意中修改自动生成的 API 文件（如 `/api/.cs` 文件）。这类文件通常由工具生成，手动修改会在下次生成时丢失，因此需要特别关注。

**分层架构遵循**：确认代码被放置在正确的架构层次中。例如，基础设施代码应该在 Infrastructure 层，而不应该出现在业务逻辑层。

**命名空间组织**：新增的类和接口应该被组织在合适的程序集和命名空间中。AI 可能会简单地将新代码放在当前位置，而忽略了整体的命名空间规划。可以提示 AI 将测试代码移动到专门的测试类中，如"将 `BicepUtilities` 的测试移动到 `BicepUtilitiesTest` 类"。

### 4. 错误处理与边界情况

AI 在处理错误和边界情况时往往不够全面：

**空值检查一致性**：验证空值检查模式是否一致应用。当某个值理论上不应该为空时（如依赖注入的服务），应该果断地告知 AI "这个值永远不会为空"，避免不必要的防御性代码。

**异常处理策略**：AI 倾向于使用通用的异常类型（如 `Exception`）。审查者应确保使用更具体的异常类型（如 `ArgumentNullException`、`InvalidOperationException`），并遵循项目的异常处理策略。

**边界情况覆盖**：AI 可能会忽略罕见的错误场景。审查者需要主动思考各种边界情况，如空集合、极值、并发冲突等，并确保代码有适当的防御性编程。

### 5. 配置与资源管理

资源管理是容易出错的领域，AI 生成的代码需要特别关注：

**资源生命周期**：检查资源的创建、配置和清理是否正确。AI 经常会忽略 `IDisposable` 的实现或 `using` 语句的使用。例如，对于 Docker Compose 环境资源，应该检查是否已经存在 dashboard 资源，避免重复创建。

**配置模式遵循**：确认代码遵循既定的配置回调和资源配置方法。AI 可能会创建新的配置模式，而不是使用现有的标准方法。

**环境特定逻辑**：确保代码在不同上下文中（如发布模式 vs 运行模式）行为正确。AI 可能只考虑了单一场景，忽略了环境差异。

### 6. 代码质量与标准

维护统一的代码标准对长期可维护性至关重要：

**文档完整性**：AI 生成的公共 API 往往缺乏完整的 XML 文档注释。对于公共类型和成员，应该要求提供清晰的文档，包括参数说明、返回值描述和使用示例。

**代码风格一致性**：留意 AI 可能引入的格式和风格不一致。虽然现代 IDE 和格式化工具可以处理大部分格式问题，但某些风格选择（如表达式风格 vs 语句风格）可能需要人工判断。

**性能考量**：批判性地评估 AI 生成设计的性能影响。AI 可能会选择简单但效率较低的实现，如不必要的集合复制、过度的内存分配或低效的算法。对于性能敏感的代码路径，要特别关注这些问题。

## AI 生成 Pull Request 的审查洞察

基于实践经验，审查 AI 生成的 Pull Request 时应注意以下几点：

**迭代细化是常态**：相比人类编写的代码，AI 生成的 PR 通常需要更多轮的反馈和增量编辑。这是正常的，不要期望一次性完美。通过持续的对话和指导，AI 会逐步改进代码质量。

**提供架构指导**：给予强有力的架构支持，确保新功能与现有模式和约定无缝整合。AI 在理解整体架构方面可能存在局限，需要人类审查者提供宏观指导。

**坚持标准执行**：保持严格的标准，因为 AI 往往会默认使用通用做法，除非明确指导。不要因为是 AI 生成的代码就降低审查标准。

**关注质量而非速度**：投入精力关注可维护性和测试覆盖率。AI 可能会快速解决当前任务，但会忽略长期关注点。审查者需要从长远角度考虑代码的影响。

**鼓励小型 PR**：建议提交更小、更聚焦的 Pull Request，这样更容易审查和集成。大型 PR 不仅审查困难，也更容易引入问题。

## 实践建议：与 AI 有效协作

在审查过程中，可以通过明确的提示与 AI 协作，提高审查效率：

- 当发现不必要的抽象时，直接告诉 AI："TokenCredential 已经是抽象的，我们不需要为它创建接口"
- 当需要补充测试时，可以说："为 GetOrCreateResourceAsync 添加单元测试"
- 当需要重组代码时，可以指示："将 BicepUtilities 的测试移动到 BicepUtilitiesTest 类"
- 当发现空值检查不当时，可以明确："这个值永远不会为空"
- 当需要检查资源重复时，可以建议："我们应该检查 DockerComposeEnvironmentResource 是否已经有 dashboard 资源，如果有则应该跳过"

这些清晰、具体的指导能帮助 AI 快速理解你的意图并做出正确的调整。

## 结语：成为卓越的 AI 代码审查者

拥抱 AI 代码审查者的角色，意味着你将引领团队成功采用新技术。通过采用深思熟虑的审查策略、执行代码标准并指导迭代优化，你可以确保 AI 带来的生产力提升不会以牺牲质量为代价。

作为审查者，你的职责是确保每一次 AI 生成的贡献都是健壮和可维护的。这不仅仅是检查代码是否能运行，更是要确保它符合团队的长期利益。通过提升审查技能，你将成为团队中不可或缺的质量守护者，引领 .NET 开发走向卓越。

在 AI 辅助开发的时代，优秀的代码审查能力比以往任何时候都更加重要。让我们以开放的心态拥抱这一变化，在提升效率的同时，坚守对代码质量的追求。

## 参考资料

- [Developer and AI Code Reviewer: Reviewing AI-Generated Code in .NET](https://devblogs.microsoft.com/dotnet/developer-and-ai-code-reviewer-reviewing-ai-generated-code-in-dotnet/)
